# Remediation Work Packages

The table below enumerates the remaining work required to bring the runtime in line with the contracts defined in `docs/`. Each package references the primary module(s), the policy gap it closes, the key deliverables, and the definition of done (DoD).

| ID | Theme | Scope & Deliverables | Dependencies | Definition of Done |
|----|-------|----------------------|--------------|--------------------|
| WP-01 | Affordance Manifest Compliance | Implement fail-fast loading for `configs/affordances/*.yaml`; add schema validation, checksum logging, and duplicate detection; surface actionable errors during startup and hot-reload. | Access to manifest schema design; integration with telemetry for checksum reporting. | Simulation aborts with a clear error when manifests are missing/invalid; validated manifests populate objects/affordances and emit checksum telemetry; regression tests cover missing/invalid/duplicate entries. |
| WP-02 | Observation Variant Fidelity | Provide fully featured encoders for `full` and `compact` observation variants (map tensor layouts, feature heads, metadata) or hard-fail configuration when unsupported; update hybrid path with documented episode-progress metric. | Hybrid encoder as reference implementation; config gating in `SimulationConfig`. | Selecting any documented variant yields the contractually defined tensor bundle; unsupported variants raise `NotImplementedError` during configuration; tests assert layouts per `docs/REQUIREMENTS.md#3. Observation Contract`. |
| WP-03 | Reward Guardrail Enforcement | Extend `RewardEngine` to enforce per-episode clipping, termination suppression windows, wage/punctuality/social reward terms, and telemetry hooks outlined in `docs/REQUIREMENTS.md#6. Rewards & Guardrails`. | Episode tracking in world state; access to employment telemetry for punctuality bonuses. | Per-agent rewards respect tick and episode clip ceilings; positive rewards are blocked for the configured window post-termination; wage/punctuality/social components emit correct metrics; unit tests cover guardrail success/failure paths. |
| WP-04 | Stability & Console Safeguards | Wire console operation handlers, perturbation scheduling, and stability monitor thresholds per `docs/ARCHITECTURE_INTERFACES.md#2.9` and `docs/CONCEPTUAL_DESIGN.md` so that invalid commands or canary breaches halt with actionable guidance. | Console command registry, queue manager instrumentation. | Console operations validate input and propagate errors; stability monitor raises and telemeters canary breaches; perturbation scripts trigger documented events; integration tests cover console misuse and stability threshold breaches. |
| WP-05 | Snapshot & Config Identity | Implement persistent world snapshots including RNG seeds, policy hash, and `config_id` validation; enforce migration hooks when `config_id` mismatches per `docs/REQUIREMENTS.md#2`. | Storage backend for snapshots; configuration migration registry. | Saving/restoring snapshots preserves world state deterministically; mismatched `config_id` raises unless a migration passes; tests cover snapshot round-trips and migration failure paths. |
| WP-06 | Telemetry Publishing Hardening | Replace placeholder telemetry publisher with real transport, KPI aggregation, and narration events per `docs/HIGH_LEVEL_DESIGN.md#Telemetry & UI Gateway`; ensure schema versioning and observer UI compatibility. | Alignment with observer UI work packages; logging infrastructure. | Telemetry stream publishes to configured transport with schema version header; KPIs and narration events are emitted; observer UI smoke tests pass against new stream; failure to connect triggers fail-fast error. |
| WP-07 | Conflict & Rivalry Systems | Complete conflict event hooks, rivalry decay, and queue fairness enforcement as described in `docs/WORK_PACKAGE_CONFLICT_INTRO.md`; integrate with observations and rewards. | Rivalry ledger storage; observation feature plumbing. | Rivalry metrics update per tick, influence observations, and gate rewards; queue fairness invariants enforced with tests; telemetry includes conflict snapshots. |

## Traceability Notes

- WP-01 through WP-03 address the policy violations surfaced during the repository audit (fail-fast, no partial degradation) and must be prioritised.
- WP-04 to WP-07 align outstanding TODOs and partially implemented systems with the roadmap outlined in `docs/CONCEPTUAL_DESIGN.md`, `docs/HIGH_LEVEL_DESIGN.md`, and the existing work-package documents.
