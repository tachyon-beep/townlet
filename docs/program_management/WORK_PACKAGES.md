# Remediation Work Packages

The table below enumerates the remaining work required to bring the runtime in line with the contracts defined in `docs/`. Each package references the primary module(s), the policy gap it closes, the key deliverables, and the definition of done (DoD).

| ID | Theme | Scope & Deliverables | Dependencies | Definition of Done |
|----|-------|----------------------|--------------|--------------------|
| WP-01 | Affordance Manifest Compliance | Implement fail-fast loading for `configs/affordances/*.yaml`; add schema validation, checksum logging, and duplicate detection; surface actionable errors during startup and hot-reload. | Access to manifest schema design; integration with telemetry for checksum reporting. | ✅ (2025-09-30) loader enforces schema/duplicates, telemetry & console expose manifest checksum, `scripts/validate_affordances.py --strict` runs in CI, regression tests cover missing/invalid/duplicate entries. |
| WP-02 | Observation Variant Fidelity | Provide fully featured encoders for `full` and `compact` observation variants (map tensor layouts, feature heads, metadata) or hard-fail configuration when unsupported; update hybrid path with documented episode-progress metric. | Hybrid encoder as reference implementation; config gating in `SimulationConfig`. | ✅ (2025-09-30) hybrid/full/compact variants implemented, config validation updated, docs refreshed, regression tests + CI cover all variants. |
| WP-03 | Reward Guardrail Enforcement | Extend `RewardEngine` to enforce per-episode clipping, termination suppression windows, wage/punctuality/social reward terms, and telemetry hooks outlined in `docs/REQUIREMENTS.md#6. Rewards & Guardrails`. | Episode tracking in world state; access to employment telemetry for punctuality bonuses. | ✅ (2025-09-30) rewards respect tick/episode clips, death window, wage & punctuality bonuses are applied, social taps active, telemetry exposes per-agent reward breakdown, unit tests cover success/failure paths. |
| WP-04 | Stability & Console Safeguards | Wire console operation handlers, perturbation scheduling, and stability monitor thresholds per `docs/program_management/snapshots/ARCHITECTURE_INTERFACES.md#2.9` and `docs/program_management/snapshots/CONCEPTUAL_DESIGN.md` so that invalid commands or canary breaches halt with actionable guidance. | Console command registry, queue manager instrumentation. | ✅ (2025-10-02) console operations validate input with admin gating, stability monitor telemeters guardrails, perturbation scheduler exposes telemetry & admin controls, regression tests cover console misuse and thresholds. |
| WP-05 | Snapshot & Config Identity | Implement persistent world snapshots including RNG seeds, policy hash, and `config_id` validation; enforce migration hooks when `config_id` mismatches per `docs/REQUIREMENTS.md#2`. | Storage backend for snapshots; configuration migration registry. | *(In progress — Phases 5.2–5.3 landed: schema v1.4, RNG streams, policy identity, migration registry & console diagnostics.)* SnapshotConfig now drives storage, autosave, identity overrides, and guardrails (2025-10-02); tests cover autosave validation, guardrail toggles, and config-driven migration registration; ops docs updated with console workflows. |
| WP-06 | Telemetry Publishing Hardening | Replace placeholder telemetry publisher with real transport, KPI aggregation, and narration events per `docs/program_management/snapshots/HIGH_LEVEL_DESIGN.md#Telemetry & UI Gateway`; ensure schema versioning and observer UI compatibility. | Alignment with observer UI work packages; logging infrastructure. | Telemetry stream publishes to configured transport with schema version header; KPIs and narration events are emitted; observer UI smoke tests pass against new stream; failure to connect triggers fail-fast error. |
| WP-07 | Conflict & Rivalry Systems | Complete conflict event hooks, rivalry decay, and queue fairness enforcement as described in `docs/work_packages/WORK_PACKAGE_CONFLICT_INTRO.md`; integrate with observations and rewards. | Rivalry ledger storage; observation feature plumbing. | Rivalry metrics update per tick, influence observations, and gate rewards; queue fairness invariants enforced with tests; telemetry includes conflict snapshots. |

## Traceability Notes

- WP-01 through WP-03 address the policy violations surfaced during the repository audit (fail-fast, no partial degradation) and must be prioritised.
- WP-04 to WP-07 align outstanding TODOs and partially implemented systems with the roadmap outlined in `docs/program_management/snapshots/CONCEPTUAL_DESIGN.md`, `docs/program_management/snapshots/HIGH_LEVEL_DESIGN.md`, and the existing work-package documents.
